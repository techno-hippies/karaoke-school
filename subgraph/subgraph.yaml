specVersion: 1.0.0
indexerHints:
  prune: auto
schema:
  file: ./schema.graphql
dataSources:
  # KaraokeEvents - Clip lifecycle + karaoke grading
  # Address: 0x51aA6987130AA7E4654218859E075D8e790f4409
  - kind: ethereum
    name: KaraokeEvents
    network: lens-testnet
    source:
      address: "0x51aA6987130AA7E4654218859E075D8e790f4409"
      abi: KaraokeEvents
      startBlock: 4210000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Clip
        - Performance
        - KaraokeSession
        - KaraokeLineScore
        - GlobalStats
      abis:
        - name: KaraokeEvents
          file: ./abis/KaraokeEvents.json
      eventHandlers:
        # Clip lifecycle events
        - event: ClipRegistered(indexed bytes32,string,string,uint32,uint32,string,indexed address,uint64)
          handler: handleClipRegistered
        - event: ClipProcessed(indexed bytes32,string,string,uint8,string,uint64)
          handler: handleClipProcessed
        - event: SongEncrypted(indexed bytes32,string,string,string,address,uint32,string,uint64)
          handler: handleSongEncrypted
        - event: ClipToggled(indexed bytes32,bool,uint64)
          handler: handleClipToggled
        # Karaoke grading events
        - event: KaraokePerformanceGraded(indexed uint256,indexed bytes32,string,indexed address,string,uint16,uint16,string,string,uint64)
          handler: handleKaraokePerformanceGraded
        - event: KaraokeSessionStarted(indexed bytes32,indexed bytes32,indexed address,uint16,uint64)
          handler: handleKaraokeSessionStarted
        - event: KaraokeLineGraded(indexed bytes32,uint16,uint16,uint8,string,uint64)
          handler: handleKaraokeLineGraded
        - event: KaraokeSessionEnded(indexed bytes32,bool,uint64)
          handler: handleKaraokeSessionEnded
      file: ./src/mappings.ts

  # TranslationEvents - Multi-language translations
  # Address: 0x0A15fFdBD70FC657C3f3E17A7faFEe3cD33DF7B6
  - kind: ethereum
    name: TranslationEvents
    network: lens-testnet
    source:
      address: "0x0A15fFdBD70FC657C3f3E17A7faFEe3cD33DF7B6"
      abi: TranslationEvents
      startBlock: 4210000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Translation
        - Clip
        - GlobalStats
      abis:
        - name: TranslationEvents
          file: ./abis/TranslationEvents.json
      eventHandlers:
        - event: TranslationAdded(indexed bytes32,string,string,string,uint16,bool,indexed address,uint64)
          handler: handleTranslationAdded
        - event: TranslationUpdated(indexed bytes32,string,string,bool,indexed address,uint64)
          handler: handleTranslationUpdated
        - event: TranslationToggled(indexed bytes32,string,bool,uint64)
          handler: handleTranslationToggled
      file: ./src/mappings.ts

  # ExerciseEvents - FSRS study cards (Say It Back + Multiple Choice)
  # Address: 0xcB2b397E02b50A0eeCecb922bb76aBE46DFb7832
  - kind: ethereum
    name: ExerciseEvents
    network: lens-testnet
    source:
      address: "0xcB2b397E02b50A0eeCecb922bb76aBE46DFb7832"
      abi: ExerciseEvents
      startBlock: 4210000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - ExerciseCard
        - ExerciseAttempt
        - LineCard
        - Clip
        - Account
        - GlobalStats
      abis:
        - name: ExerciseEvents
          file: ./abis/ExerciseEvents.json
      eventHandlers:
        - event: TranslationQuestionRegistered(indexed bytes32,indexed bytes32,indexed bytes32,string,uint16,string,string,uint16,address,uint64)
          handler: handleTranslationQuestionRegistered
        - event: TriviaQuestionRegistered(indexed bytes32,string,string,string,uint16,indexed address,uint64)
          handler: handleTriviaQuestionRegistered
        - event: SayItBackAttemptGraded(indexed uint256,indexed bytes32,indexed bytes32,uint16,address,uint16,uint8,string,uint64)
          handler: handleSayItBackAttemptGraded
        - event: MultipleChoiceAttemptGraded(indexed uint256,indexed bytes32,indexed address,uint16,uint8,string,uint64)
          handler: handleMultipleChoiceAttemptGraded
        - event: QuestionToggled(indexed bytes32,bool,indexed address,uint64)
          handler: handleQuestionToggled
      file: ./src/mappings.ts

  # AccountEvents - User account management
  # Address: 0x3709f41cdc9E7852140bc23A21adCe600434d4E8
  - kind: ethereum
    name: AccountEvents
    network: lens-testnet
    source:
      address: "0x3709f41cdc9E7852140bc23A21adCe600434d4E8"
      abi: AccountEvents
      startBlock: 4210000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Account
        - GlobalStats
      abis:
        - name: AccountEvents
          file: ./abis/AccountEvents.json
      eventHandlers:
        - event: AccountCreated(indexed address,indexed address,string,string,uint32,uint64)
          handler: handleAccountCreated
        - event: AccountMetadataUpdated(indexed address,string,indexed address,uint64)
          handler: handleAccountMetadataUpdated
        - event: AccountVerified(indexed address,bool,indexed address,uint64)
          handler: handleAccountVerified
      file: ./src/mappings.ts
